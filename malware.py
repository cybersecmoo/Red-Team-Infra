import ssh_client as client
import ssh_server as server
from http_client import BeaconClient
import threading
import queue
import time


def main():
    server_commands = queue.Queue()
    ssh_client_commands = queue.Queue()
    master_commands_queue = queue.Queue()

    server_thread = server.ServerThread(server_commands)
    client_thread = client.ClientThread(ssh_client_commands)
    beaconThread = BeaconClient(
        master_commands_queue, server_commands, ssh_client_commands)

    # TODO: Only start the ssh threads when we need to (start them from within the beacon client?)
    server_thread.start()
    client_thread.start()
    beaconThread.start()

    # TODO: Remove this section; interaction will come via SSH/HTTP now
    commands.put("OPEN_TUNNEL")
    commands.put("9090")
    time.sleep(2)

    try:
        while True:
            command = input("Command: ")
            commands.put(command)
    except KeyboardInterrupt:
        commands.put("CLOSE_TUNNEL")
        client_thread.join()
        server_thread.join()


if __name__ == "__main__":
    main()
